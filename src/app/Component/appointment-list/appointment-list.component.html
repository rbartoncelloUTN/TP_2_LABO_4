<body>
  <div *ngFor="let appointment of appointments" class="appointment-card">
    <div class="info">
      <div class="specialist-name">
        {{ appointment.specialistName }}
      </div>
      <div class="specialty">
        {{ appointment.specialty.toLocaleUpperCase() }}
      </div>
      <div style="display: flex; flex-direction: row; gap: 10px">
        <div>Dia y hora:</div>
        <div class="date-time">
          {{ appointment.date | date : "dd/MM/yyyy HH:mm" }}
        </div>
      </div>
      <div style="display: flex; flex-direction: row; gap: 10px">
        <div>Paciente:</div>
        <div class="date-time">
          {{ appointment.patientId | findPatient : appointment.patientId }}
        </div>
      </div>

      <div class="status">{{ appointment.status }}</div>
      <div class="separator"></div>
      <div
        style="
          display: flex;
          flex-direction: row;
          gap: 15px;
          justify-content: space-around;
        "
      >
        <div
          class="btn"
          [hiddenComponent]="!appointment.review?.comment"
          (click)="handleReviewAppointment(appointment)"
        >
          Rese√±a
        </div>
        <div
          class="btn"
          [hiddenComponent]="
            !(
              !!appointment.review?.comment &&
              appointment.status === 'Realizado' &&
              currentUser?.rol === 'Paciente'
            )
          "
        >
          Encuesta
        </div>
        <div
          class="btn"
          [hiddenComponent]="
            appointment.status !== 'Realizado' ||
            currentUser?.rol !== 'Paciente'
          "
          (click)="handleCommentAppointment(appointment)"
        >
          Calificar
        </div>
      </div>
      <div class="button-container">
        <button
          class="btn"
          [hiddenComponent]="
            currentUser?.rol !== 'Especialista' ||
            hideOptionsWithSpecialityRol(appointment)
          "
          (click)="handleAcceptAppointment(appointment)"
        >
          Aceptar
        </button>
        <button
          class="btn"
          [hiddenComponent]="
            currentUser?.rol !== 'Especialista' ||
            hideOptionsWithSpecialityRol(appointment)
          "
          (click)="handleRejectedAppointment(appointment)"
        >
          Rechazar
        </button>
        <button
          class="btn"
          [hiddenComponent]="
            currentUser?.rol !== 'Especialista' ||
            !(
              currentUser?.rol === 'Especialista' &&
              appointment.status === 'Aceptado'
            )
          "
          (click)="handleFinishedAppointment(appointment)"
        >
          Finalizar
        </button>
      </div>
      <div class="button-container">
        <button
          class="btn btn-cancel"
          [hiddenComponent]="
            appointment.status === 'Cancelado' ||
            (currentUser?.rol === 'Paciente' &&
              appointment.status === 'Realizado') ||
            hideOptionsWithSpecialityRol(appointment) ||
            hideOptionsWithAdminRol(appointment)
          "
          (click)="handleCancelAppointment(appointment)"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>
</body>
